<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity4">
<head>
<title>Distribución Lotes en Placas -covid19</title>
<object th:include="fragmentos :: fragmentoHead" th:remove="tag"></object>

</head>
<body>

	<object th:replace="fragmentos :: header-responsive" th:remove="tag"></object>
<div id="lotesRecibidos" class="container">
	<div class="row justify-content-center mt-1, titulo-menu">
			<h5>Gestión de lotes en placas</h5>
    </div>
    <div class="row justify-content-left mt-3">
    	<div class="col-xs-12 col-sm-12 col-md-3 col-lg-3">		      
				<div class="list-group">
				  <a href="/laboratorioUni/buscarLotes" class="list-group-item list-group-item-action text-white bg-secondary">Gestión lotes centros de salud</a>
				  <a href="/laboratorioUni/buscarPlacas" class="list-group-item list-group-item-action">Gestión placas Visavet</a>
				  <a href="#" class="list-group-item list-group-item-action">Salir</a>
				</div>
		</div>
  
	
   <div class="col-xs-12 col-sm-12 col-md-9 col-lg-9">		   
   <form action="#" th:action="@{/laboratorioUni/buscarLotes}"
			id="formularioPrueba" method="post" th:object="${lotePlacaVisavetBean}"
			class="form-horizontal">
        <div class="row justify-content-end mt-3">
			<div class="col-2">
				<button type="button" th:onClick="|altaNuevaPlaca(); return false|"  class="btn btn-secondary">Alta nueva placa</button>
			</div>
		</div>	   

			<fieldset id="criteriosBusqueda" style="display:none" class="form-group border p-2">
		    <legend class="w-auto">Asignación de referencias a muestras</legend>
			  <div class="row">
				<div class="col-3 form-group">
				<label class="col-xs-2">Placa número:</label><label class="col-xs-2"><span id="numPlacaSpan"/></label>
				</div>
				<div class="col-9 form-group">
				<label class="col-xs-2">Tamaño:</label>
				
						<label class="col-xs-2">
							 <select class="form-control form-control-sm" id="tamano" th:field="*{placa.tamano}">
					              <option th:each="var: ${lotePlacaVisavetBean.listaTamanosDisponibles}"
									th:value="${var}" th:text="${var}"
									th:select="${lotePlacaVisavetBean.placa.tamano}">Tamaño</option>
				           </select>
						</label>
			    </div>
			   
			    <div class="col-12 form-group">
			   <!--  <div class="col-6 form-group">
				<label class="col-xs-2">#Lote:</label>
						<label class="col-xs-2">
							 <select class="form-control form-control-sm" id="loteSeleccionado">
					              <option th:each="var: ${lotePlacaVisavetBean.listaLotesDisponibles}"
									th:value="${var.id}" th:text="${var.numLote} +  ' - ' + ${var.centroProcedencia} + ' - '   + ${#lists.size(var.listaMuestras)}" >lote</option>
				           </select>
						</label>
			    </div> --><div class="col-6 form-group" th:each="var: ${lotePlacaVisavetBean.listaLotesDisponibles}">
			     <label id="tamanoMuestra" >Nº muestras del lote  <span th:text="${var.numLote}"></span>: <span th:text="${#lists.size(var.listaMuestras)}"></span></label>
			   </div> 
			   <div class="col-6 form-group">Nº total:<span th:text="${lotePlacaVisavetBean.totalMuestras}"/></div>
			    <div class="col-6 form-group">
				<button type="button" th:onClick="|asignarPlaca(); return false|"  class="btn btn-secondary">Asignar</button>
			    </div>
			    
			  </div>
			 

		</fieldset>
		
		</form>
		 <form action="#" th:action="@{/laboratorioUni/buscarPlacas}" id="formularioConReferencias" method="post" th:object="${lotePlacaVisavetBean}" th:modelAttribute="${lotePlacaVisavetBean}"
			class="form-horizontal">
		<!-- Aqui vienen los resultados -->
		<div class="col-xs-12 col-sm-12 col-md-3 col-lg-3">	&nbsp;</div>
		<div id="capaResultados" 
			class="row formPnl1">
		
				<table class="col-xs-12 table" id="tablaResultadosLotes" >
						 <thead class="thead-light">
				<tr>
				
				    <th  width="1%" style="text-align: left;">#Placa</th>
					<th  width="1%" style="text-align: left;">#Lote</th>
					<th width="10%" style="text-align: left;">Centro</th>
					<th  width="5%" style="text-align: left;">Nº de muestras</th>
				
					
				
				</tr>
				</thead>
				<tbody>
				<tr id="trGroup"></tr>
				<tr id="trGroup" th:each="unResultado,count : ${lotePlacaVisavetBean.placa.listaLotes}">
					   <td colspan="4">    
					     <table class="col-xs-12 table" id="tablaMuestras" >
				    <tbody>
				    <tr>
					           <td width="2%">
					          <input type="hidden" th:field="${lotePlacaVisavetBean.placa.listaLotes[__${count.index}__].idPlacaVisavet}"/>
								<span th:text="${unResultado.idPlacaVisavet}"></span>
								</td>
								<td width="1%">
								<input type="hidden" th:field="${lotePlacaVisavetBean.placa.listaLotes[__${count.index}__].id}"/>
								<span th:text="${unResultado.numLote}"></span>
								</td>
                                <td width="10%">
                                <span th:text="${unResultado.centroProcedencia}"></span>
								</td>
                                <td width="5%">
                                
								<span th:text="${#lists.size(unResultado.listaMuestras)}"></span>
								</td>
                              <td id="mensajes_log" style="text-align: left;" width="1%">
                              <a th:data-lote="${unResultado.id}" href="#" th:onclick="|mostrarMuestrasPlacas(this.getAttribute('data-lote'));|">
										<i class="fa fa-table" aria-hidden="true" 
										style="font-size: 1.2em;"></i>
								</a>
								
								</td>
							
				</tr>
				<tr th:id="muestra+${unResultado.id}" style="display:none;">
				<!--  <tr th:if="${#lists.size(unResultado.listaMuestras)>0}"  th:each="unaMuestra,countM : ${unResultado.listaMuestras}">
					-->
					<td colspan="5">  
					<table class="col-xs-12 table">
					<tr th:if="${#lists.size(unResultado.listaMuestras)>0}"  th:each="unaMuestra,countM : ${unResultado.listaMuestras}">
					
								<td width="2%">
								<input type="hidden" th:field="${lotePlacaVisavetBean.placa.listaLotes[__${count.index}__].listaMuestras[__${countM.index}__].id}"/>
								<span th:text="${unaMuestra.tipoMuestra}"></span>
								</td>
								<td width="2%">
								<span th:text="${unaMuestra.etiqueta}"></span>
								</td>
								<td width="2%">
								<input type="hidden" th:field="${lotePlacaVisavetBean.placa.listaLotes[__${count.index}__].listaMuestras[__${countM.index}__].referenciaInterna}"/>
								<input th:id="${unaMuestra.referenciaInterna}" th:value="${unaMuestra.referenciaInterna}"></span>
								</td>
					</tr>
					</table>
					</td>			
					</tr>	
				</tbody>
		    	</table>
				
				
				
				
				</tr>
		
		
			
				</tbody>
				
				</table>
			<!--  input grabar o grabar y finalizar -->
			<!-- enviamos el mismo formulario a la misma url con este hidden voy a saber que quiere hacer el usuairo -->
			<!--  si grabar o grabar y pasar a estado finalizado -->
			<input type="hidden" th:field="${lotePlacaVisavetBean.accion}" id="accion" />
			<button type="submit" th:onClick="|seleccionAccion('grabar'); return false|"  class="btn btn-secondary">Grabar</button>
			<button type="submit" th:onClick="|seleccionAccion('grabaryFinalizar'); return false|"  class="btn btn-secondary">Grabar y Finalizar</button>
			</div>
		
		 <!--  capa de resultados -->
		</form>
		</div>
</div>
	</div>
		</div> 	
	

<object th:replace="fragmentos :: footer-responsive" th:remove="tag"></object>
<!--  contenedor de todo -->
	<!--  
	<script th:src="@{/js/util.js}" src="static/js/util.js"
		type="text/javascript"></script>
	<script th:src="@{/js/funcionesLotes.js}"
		src="static/js/funcionesLotes.js" type="text/javascript"></script>
	<object th:include="fragmentos :: scriptsBootstrap" th:remove="tag"></object>
	-->
	
</body>
</html>