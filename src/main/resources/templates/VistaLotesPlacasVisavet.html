<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity4">
<head>
<title>Distribución Lotes en Placas -covid19</title>
<object th:include="fragmentos :: fragmentoHead" th:remove="tag"></object>

</head>
<body>

	<object th:replace="fragmentos :: header-responsive" th:remove="tag"></object>
	<object th:replace="fragmentos :: navbar-responsive" th:remove="tag"></object>
<div id="lotesRecibidos" class="container">
	<div class="row justify-content-center mt-1">
			<h5>Gestión de lotes en placas</h5>
    </div>
    <div class="row justify-content-left mt-3">
    	<!-- <div class="col-xs-12 col-sm-12 col-md-3 col-lg-3">		      
				<div class="list-group">
				  <a href="/laboratorioUni/buscarLotes" class="list-group-item list-group-item-action text-white bg-secondary">Gestión lotes centros de salud</a>
				  <a href="/laboratorioUni/buscarPlacas" class="list-group-item list-group-item-action">Gestión placas Visavet</a>
				  <a href="#" class="list-group-item list-group-item-action">Salir</a>
				</div>
		</div>
   -->
	
   <div class="col-xs-12 col-sm-12 col-md-9 col-lg-9">		   
   <form action="#" th:action="@{/laboratorioUni/buscarLotes}"
			id="formularioPrueba" method="post" th:object="${lotePlacaVisavetBean}"
			class="form-horizontal">
        <div class="row justify-content-end mt-3">
			<div class="col-2">
			<!-- -->
				<button type="button"  th:disabled="${botonAltaNoMostrar}" th:onClick="|altaNuevaPlaca(); return false|"  class="btn btn-secondary">Alta nueva placa</button>
			</div>
		</div>	   

			<fieldset id="criteriosBusqueda" style="display:none" class="form-group border p-2">
		    <legend class="w-auto font-weight-bold m-0" >Asignación de referencias a muestras</legend>
			  <div class="row">
				<div class="col-3 form-group">
				<label class="col-xs-2">Placa número:</label><label class="col-xs-2"><span style="font-weight:bold;" id="numPlacaSpan"/></label>
				</div>
				<div class="col-6 form-group">
				<label class="col-xs-2">Tamaño:</label>
				
						<label class="col-xs-2">
							 <select class="form-control form-control-sm" id="tamano" th:field="*{placa.tamano}">
					              <option th:each="var: ${lotePlacaVisavetBean.listaTamanosDisponibles}"
									th:value="${var}" th:text="${var}"
									th:select="${lotePlacaVisavetBean.placa.tamano}">Tamaño</option>
				           </select>
						</label>
			    </div>
			    <div class="col-3 form-group">
			     <button type="button" th:onClick="|asignarPlaca(); return false|"  class="btn btn-secondary">Asignar</button>
			   </div>
			   </div>
			    <div class="row form-group">
			    <table class="col-6 table">
				<thead class="thead-light">
				<tr>
				    <th scope="col">#Lote</th>
					<th scope="col">Nº de muestas</th>
				</tr>
				</thead>
				<tbody>
				<tr th:each="var: ${lotePlacaVisavetBean.listaLotesDisponibles}">
				<td>
				<span th:text="${var.numLote}"></span></td>
				<td><span th:text="${#lists.size(var.listaMuestras)}"></span></td>
				</tr>
				<tr><td><span>Nº Total</span></td><td><span th:text="${lotePlacaVisavetBean.totalMuestras}" id="totalMuestras"></span></td></tr>
				</tbody>
				</table>	
			 
			   </div>
			    <div class="row form-group">
			    <div class="col-9 form-group justify-content-end mt-3">
			   
			   </div>
			    </div>
			   
			   

		</fieldset>
		
		</form>
		 <form action="#" th:action="@{/laboratorioUni/buscarPlacasProcesar}" id="formularioConReferencias" method="post" th:object="${lotePlacaVisavetBean}" th:modelAttribute="${lotePlacaVisavetBean}"
			class="form-horizontal">
		<!-- Aqui vienen los resultados -->
		<div class="col-xs-12 col-sm-12 col-md-3 col-lg-3">	&nbsp;</div>
		<div id="capaResultados" 
			class="row formPnl1">
		
				<table class="col-xs-12 table"  id="tablaResultados" >
				<thead class="thead-light">
				
				<tr>
				    <th width="25%">#Placa</th>
					<th width="25%">#Lote</th>
					<th width="25%">Centro</th>
					<th width="25%">Nº de muestras</th>
				</tr>
				</thead>
				 </table>
				<table class="col-xs-12" style="border: none;width:100%"  id="tablaLotes"> 
				<tbody>
				
				<tr id="trGroup"  style="border: none;" th:fragment="trGroup" th:each="unResultado,count : ${lotePlacaVisavetBean.placa.listaLotes}">
				 <td colspan="4">  
					   
					    <table  class="col-xs-12"  style="border: none;" width="100%" id="tablaMuestras">
				    <tbody>
				    <tr  style="border: none;">
					           <td width="25%">
					          <input type="hidden" th:field="${lotePlacaVisavetBean.placa.listaLotes[__${count.index}__].idPlacaVisavet}"/>
								<span th:text="${unResultado.idPlacaVisavet}"></span>
								</td>
								<td width="25%">
								<input type="hidden" th:field="${lotePlacaVisavetBean.placa.listaLotes[__${count.index}__].id}"/>
								<span th:text="${unResultado.numLote}"></span>
								</td>
                                <td width="25%">
                                <span th:text="${unResultado.centroProcedencia}"></span>
								</td>
                                
                              <td width="25%">
                              <a th:data-lote="${unResultado.id}" href="#" th:onclick="|mostrarMuestrasPlacas(this.getAttribute('data-lote'));|">
										<i class="fa fa-table" aria-hidden="true" 
										style="font-size: 1.2em;"></i>
								</a>
								<span th:text="${#lists.size(unResultado.listaMuestras)}"></span>
								</td>
							
				</tr>
				<tr th:id="muestra+${unResultado.id}" style="display:none;">
				<td colspan="4">  
					<table  class="col-xs-12 table">
					<thead><tr><th scope="col">Tipo Muestra</th><th scope="col">Etiqueta</th><th scope="col">Referencia Interna</th></tr></thead>
					<tbody>
					<tr th:if="${#lists.size(unResultado.listaMuestras)>0}"  th:each="unaMuestra,countM : ${unResultado.listaMuestras}">
					
								<td width="31%">
								<input type="hidden" th:field="${lotePlacaVisavetBean.placa.listaLotes[__${count.index}__].listaMuestras[__${countM.index}__].id}"/>
								<span th:text="${unaMuestra.tipoMuestra}"></span>
								</td>
								<td width="31%">
								<span th:text="${unaMuestra.etiqueta}"></span>
								</td>
								<td width="38%">
								<input type="hidden" th:field="${lotePlacaVisavetBean.placa.listaLotes[__${count.index}__].listaMuestras[__${countM.index}__].referenciaInterna}"/>
								<!-- th:id="${unaMuestra.referenciaInterna}" th:value="${unaMuestra.referenciaInterna}" -->
								<input th:field="${lotePlacaVisavetBean.placa.listaLotes[__${count.index}__].listaMuestras[__${countM.index}__].referenciaInterna}" ></span>
								</td>
					</tr>
					</tbody>
					</table>
					</td>			
					</tr>	
			 </tbody>
		    	</table>
				
				 </tr>
				</tbody>
				</table>  
			<!--  input grabar o grabar y finalizar -->
			<!-- enviamos el mismo formulario a la misma url con este hidden voy a saber que quiere hacer el usuairo -->
			<!--  si grabar o grabar y pasar a estado finalizado -->
			<input type="hidden" th:field="${lotePlacaVisavetBean.accion}" id="accion" />
			</div>
		
		<button type="submit" id="grabar" th:onClick="|seleccionAccion('grabar'); return false|"  class="btn btn-secondary">Grabar</button>&nbsp;
			<button type="submit"   id="grabaryFinalizar" th:onClick="|seleccionAccion('grabaryFinalizar'); return false|"  class="btn btn-secondary">Grabar y Finalizar</button>
			
		 <!--  capa de resultados -->
		</form>
		</div>
</div>
	</div>
		</div> 	
	

<object th:replace="fragmentos :: footer-responsive" th:remove="tag"></object>
<object th:include="fragmentos :: scripts" th:remove="tag"></object>
<!--  contenedor de todo -->
	<!--  
	<script th:src="@{/js/util.js}" src="static/js/util.js"
		type="text/javascript"></script>
	<script th:src="@{/js/funcionesLotes.js}"
		src="static/js/funcionesLotes.js" type="text/javascript"></script>
	<object th:include="fragmentos :: scriptsBootstrap" th:remove="tag"></object>
	-->
	
</body>
</html>