<!DOCTYPE html>

<html xmlns:th="http://www.thymeleaf.org">
<head>
<title>PCR-COVID19 - MUESTRAS</title>
<object th:include="fragmentos :: fragmentoHead" th:remove="tag"></object>
</head>
<body>

	<object th:replace="fragmentos :: header-responsive" th:remove="tag"></object>
	<object th:replace="fragmentos :: navbar-responsive" th:remove="tag"></object>
	<div class="container">	
	
	<form action="#" th:action="@{/centroSalud/lote/guardar}" method="post" th:object="${beanLote}" id="formGuardar" role="form">
		<input type="hidden" th:field="${beanLote.id}"  th:value="${beanLote.id}" />
		<input type="hidden" name="estado" th:value="${beanLote.estado.estado.codNum}" th:if="${beanLote.estado} != null"/> 
		<fieldset id="datosLote" class="form-group border p-2" th:disabled="!${editable}">
			<legend class="w-auto font-weight-bold" th:if="${beanLote.tieneMuestras}">Lote con muestras</legend>
			<legend class="w-auto font-weight-bold" th:if="!${beanLote.tieneMuestras}">Lote sin muestras</legend>
			<div class="row">
				<div class="col-4 form-group">
					<label>Código</label>
				 	<input type="text" class="form-control form-control-sm" th:field="${beanLote.numLote}"  th:value="${beanLote.numLote}" required maxlength="50"/>
				 	<label class="text-warning" th:if="${#fields.hasErrors('numLote')}" th:errors="${beanLote.numLote}"></label>
				</div>
				<div class="col-4 form-group">
					<label>Capacidad</label>
				 	<input type="text" class="form-control form-control-sm" th:field="${beanLote.capacidad}"  th:value="${beanLote.capacidad}" pattern="[0-9]+" maxlength="3" required/>
				</div>
			</div>		
			<div class="row">			
				<div class="col-4 form-group">
					<label>Laboratorio</label>															
				 	<ul style="list-style: none;">
				 		<li>
				 			<input type="radio" name="idLaboratorio" id="idLaboratorioSin" th:field="${beanLote.idLaboratorio}" value=""></input>
				 			<label>Sin laboratorio</label>
				 		</li>				 		
				 		<li th:each="var : ${listaLaboratorios}">
					    	<input type="radio" th:field="*{idLaboratorio}" th:value="${var.id}" />
					    	<label th:for="${#ids.prev('idLaboratorio')}" th:text="${var.nombre}"></label>
					    	<!-- TODO - OCUPACION CAPACIDAD 
					    	<div style="padding-left:15px">
						    	<span th:if="${var.ocupacion} != null" th:text="${'Ocupación: ' + var.ocupacion}"></span>
						    	<span th:if="${var.capacidad} != null" th:text="${'Capacidad: ' + var.capacidad}"></span>
					    	</div>
					    	 -->
					  	</li>
					</ul>
				</div>				
			</div>
			<div class="row">
				<div class="col-4 form-group" th:if="${beanLote.estado == null}">
					<label>Estado</label>
				 	<input type="text" class="form-control form-control-sm" disabled></input>
				</div>
				<div class="col-4 form-group" th:if="${beanLote.estado != null}">
					<label>Estado</label>
				 	<input type="text" class="form-control form-control-sm" disabled th:value="${beanLote.estado.estado.descripcion}"></input>
				</div>
				<div class="col-4 form-group">
					<label>Fecha envío</label>
				 	<input type="text" class="form-control form-control-sm" disabled th:value="${#dates.format(beanLote.fechaEnvio, 'dd/MM/yyyy')}"></input>
				</div>				
			</div>					
		</fieldset>
		

		<!-- ACCCIONES -->
		<div class="row justify-content-center mt-3">
			<div class="col-2">
				<a th:href="@{/centroSalud/lote}" class="btn btn-secondary">Volver</a>				
			</div>
			<div class="col-2">
				<button th:disabled="!${editable}" type="submit" class="btn btn-secondary">Guardar</button>
			</div>
			<div class="col-2" th:if="${beanLote.tieneMuestras}">
				<a id="accionEnviado" th:classappend="${beanLote.idLaboratorio == null} ? disabled : ''" th:href="@{/centroSalud/lote/enviado/{id}(id=${beanLote.id})}" class="btn btn-secondary">Enviado</a>
			</div>			
		</div>					
	</form>

	</div>
	<object th:replace="fragmentos :: footer-responsive" th:remove="tag"></object>
    <object th:replace="fragmentos :: scripts" th:remove="tag"></object>
    <script type="text/javascript">
    	// habilita/deshabilita la accion enviado lote
	    $(function () {
	        $("input[name='idLaboratorio']").click(function () {
	        	var radioValue = $("input[name='idLaboratorio']:checked"). val();
	        	if (radioValue == '') {
	        		$("#accionEnviado").addClass('disabled');
		        } else {
	        		$("#accionEnviado").removeClass('disabled');
		        }		        
	        });
	    });
    </script>
</body>
</html>